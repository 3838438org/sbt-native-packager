<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Customize Java Applications &mdash; sbt-native-packager 1.0.5-M1 documentation</title>
    
    <link rel="stylesheet" href="../../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/bootswatch-3.2.0/yeti/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/bootstrap-sphinx.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1.0.5-M1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../../_static/bootstrap-3.2.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="sbt-native-packager 1.0.5-M1 documentation" href="../../index.html" />
    <link rel="up" title="Java Application Archetype" href="index.html" />
    <link rel="next" title="Generating files for the package" href="generating-files.html" />
    <link rel="prev" title="My First Packaged Project" href="my-first-project.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../index.html">
          sbt-native-packager</a>
        <span class="navbar-text navbar-version pull-left"><b>1.0</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../gettingstarted.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gettingstarted.html#packaging-formats">Packaging Formats</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gettingstarted.html#archetypes">Archetypes</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../gettingstarted.html#sitemap">Sitemap</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Java Application Archetype</a></li>
<li class="toctree-l1"><a class="reference internal" href="../java_server/index.html">Java Server Application Archetype</a></li>
<li class="toctree-l1"><a class="reference internal" href="../akka_app/index.html">Akka Microkernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cheatsheet.html">Archetype Cheatsheet</a></li>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Project Archetypes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../formats/index.html">Packaging Formats</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../topics/index.html">Advanced Topics</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">Customize Java Applications</a><ul>
<li><a class="reference internal" href="#customizing-the-application">Customizing the Application</a><ul>
<li><a class="reference internal" href="#via-build-sbt">Via build.sbt</a></li>
<li><a class="reference internal" href="#via-application-ini">Via Application.ini</a></li>
<li><a class="reference internal" href="#bashscript-defines">BashScript defines</a></li>
<li><a class="reference internal" href="#testing-the-configuration">Testing the configuration</a></li>
<li><a class="reference internal" href="#customize-application-ini-name">Customize application.ini name</a></li>
</ul>
</li>
<li><a class="reference internal" href="#example-typesafe-config-library">Example: Typesafe Config Library</a><ul>
<li><a class="reference internal" href="#configuring-for-windows">Configuring for Windows</a></li>
<li><a class="reference internal" href="#more-complex-scripts">More Complex Scripts</a></li>
</ul>
</li>
<li><a class="reference internal" href="#overriding-templates-bash-bat">Overriding Templates (Bash/Bat)</a><ul>
<li><a class="reference internal" href="#overriding-bat-templates-src-templates-bat-template-or-a-custom-path-using-batscripttemplatelocation">Overriding bat templates (<tt class="docutils literal"><span class="pre">src/templates/bat-template</span></tt> or a custom path using <tt class="docutils literal"><span class="pre">batScriptTemplateLocation</span></tt>)</a></li>
<li><a class="reference internal" href="#overriding-bash-templates-src-templates-bash-template-or-a-custom-path-using-bashscripttemplatelocation">Overriding bash templates (<tt class="docutils literal"><span class="pre">src/templates/bash-template</span></tt> or a custom path using <tt class="docutils literal"><span class="pre">bashScriptTemplateLocation</span></tt>)</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="my-first-project.html" title="Previous Chapter: My First Packaged Project"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; My First Package...</span>
    </a>
  </li>
  <li>
    <a href="generating-files.html" title="Next Chapter: Generating files for the package"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">Generating files... &raquo;</span>
    </a>
  </li>
              
            
            
            
            
              <li class="hidden-sm">
<div id="sourcelink">
  <a href="../../_sources/archetypes/java_app/customize.txt"
     rel="nofollow">Source</a>
</div></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12">
      
  <div class="section" id="customize-java-applications">
<h1>Customize Java Applications<a class="headerlink" href="#customize-java-applications" title="Permalink to this headline">¶</a></h1>
<p>While the native packager tries to provide robust BASH/BAT scripts for your applications, they may not always be enough.
The native packager provides a mechanism where the template used to create each script can be customized or directly
overridden.</p>
<p>The easiest way to add functionality to the default script is by adding <tt class="docutils literal"><span class="pre">bashScriptExtraDefines</span></tt> :doc:` as described
in adding configuration for applications &lt;/archetypes/java_app/customize&gt;`. Customizing the bash
script will effect all platform-specific builds. The server archetype provides a further level of customization for
specific System Loaders and Package types. These template file are described in
<a class="reference internal" href="../java_server/customize.html"><em>configuring servers</em></a>.</p>
<div class="section" id="customizing-the-application">
<h2>Customizing the Application<a class="headerlink" href="#customizing-the-application" title="Permalink to this headline">¶</a></h2>
<div class="alert alert-info" role="alert">
  <span class="glyphicon glyphicon-info-sign" aria-hidden="true"></span>
  If you plan to use the Java Server Archetype you have <a href="../java_server/customize.html">other options to configure
  your application</a>.<br> This section is for non-server, standalone applications. However everything will work for server
  applications as well.
</div><p>After <a class="reference internal" href="my-first-project.html"><em>creating a package</em></a>, the very next thing needed, usually, is the ability for users/ops to customize
the application once it&#8217;s deployed. Let&#8217;s add some configuration to the newly deployed application.</p>
<p>There are generally two types of configurations:</p>
<ul class="simple">
<li>Configuring the JVM and the process</li>
<li>Configuring the Application itself.</li>
</ul>
<p>You have three options.</p>
<div class="section" id="via-build-sbt">
<h3>Via build.sbt<a class="headerlink" href="#via-build-sbt" title="Permalink to this headline">¶</a></h3>
<p>First, you can specify your options via the <tt class="docutils literal"><span class="pre">build.sbt</span></tt>.</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="n">javaOptions</span> <span class="n">in</span> <span class="nc">Universal</span> <span class="o">++=</span> <span class="nc">Seq</span><span class="o">(</span>
    <span class="c1">// -J params will be added as jvm parameters</span>
    <span class="s">&quot;-J-Xmx64m&quot;</span><span class="o">,</span>
    <span class="s">&quot;-J-Xms64m&quot;</span><span class="o">,</span>

    <span class="c1">// others will be added as app parameters</span>
    <span class="s">&quot;-Dproperty=true&quot;</span><span class="o">,</span>
    <span class="s">&quot;-port=8080&quot;</span><span class="o">,</span>

    <span class="c1">// you can access any build setting/task here</span>
   <span class="s">s&quot;-version=</span><span class="si">${</span><span class="n">version</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s">&quot;</span>
<span class="o">)</span>
</pre></div>
</div>
<p>For the <tt class="docutils literal"><span class="pre">-X</span></tt> settings you need to add a suffix <tt class="docutils literal"><span class="pre">-J</span></tt> so the start script will
recognize these as vm config parameters.</p>
</div>
<div class="section" id="via-application-ini">
<h3>Via Application.ini<a class="headerlink" href="#via-application-ini" title="Permalink to this headline">¶</a></h3>
<p>The second option is to create <tt class="docutils literal"><span class="pre">src/universal/conf/application.ini</span></tt> with the following template</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="c"># Setting -X directly (-J is stripped)</span>
<span class="c"># -J-X</span>
-J-Xmx1024

<span class="c"># Add additional jvm parameters</span>
-Dkey<span class="o">=</span>val

<span class="c"># Turn on JVM debugging, open at the given port</span>
<span class="c"># -jvm-debug &lt;port&gt;</span>

<span class="c"># Don&#39;t run the java version check</span>
<span class="c"># -no-version-check</span>

<span class="c"># enabling debug and sending -d as app argument</span>
<span class="c"># the &#39;--&#39; prevents app-parameter swallowing when</span>
<span class="c"># using a reserved parameter. See #184</span>
<span class="c"># -d -- -d</span>
</pre></div>
</div>
<p>The file will be installed to <tt class="docutils literal"><span class="pre">${app_home}/conf/application.ini</span></tt> and read from there
by the startscript. You can use <tt class="docutils literal"><span class="pre">#</span></tt> for comments and new lines as you like. This file
currently doesn&#8217;t has any variable substitution. We recommend using the <tt class="docutils literal"><span class="pre">build.sbt</span></tt> if
you need any information from your build.</p>
<p>The configuration file for bash scripts takes arguments for the BASH file on each line,
and allows comments which start with the <tt class="docutils literal"><span class="pre">#</span></tt> character.  Essentially, this provides
a set of default arguments when calling the script.</p>
<p>By default, any file in the <tt class="docutils literal"><span class="pre">src/universal</span></tt> directory is packaged. This is a convenient
way to include things like licenses, and readmes.</p>
</div>
<div class="section" id="bashscript-defines">
<h3>BashScript defines<a class="headerlink" href="#bashscript-defines" title="Permalink to this headline">¶</a></h3>
<p>The last option is to use the <tt class="docutils literal"><span class="pre">bashScriptExtraDefines</span></tt>. Generally you can add arbitrary
bash commands here, but for configurations you have two methods to add jvm and app parameters.</p>
<div class="highlight-python"><div class="highlight"><pre>bashScriptExtraDefines += &quot;&quot;&quot;addJava &quot;-Dconfig.file=${app_home}/../conf/app.config&quot;&quot;&quot;&quot;
bashScriptExtraDefines += &quot;&quot;&quot;addApp &quot;--port=8080&quot;&quot;&quot;
</pre></div>
</div>
</div>
<div class="section" id="testing-the-configuration">
<h3>Testing the configuration<a class="headerlink" href="#testing-the-configuration" title="Permalink to this headline">¶</a></h3>
<p>Now, if we run the <tt class="docutils literal"><span class="pre">stage</span></tt> task, we&#8217;ll see this file show up in the distribution</p>
<div class="highlight-python"><div class="highlight"><pre>$ sbt stage
$ ls target/universal/stage
   bin/
   conf/
   lib/
$ ls target/universal/stage/conf
   application.ini
</pre></div>
</div>
<p>Execute the script in debug mode to see what command line it executes</p>
<div class="highlight-python"><div class="highlight"><pre>./target/universal/stage/bin/example-cli -d
    # Executing command line:
    java
    -Xms1024m
    -Xmx1024m
    -XX:MaxPermSize=256m
    -XX:ReservedCodeCacheSize=128m
    -DsomeProperty=true
    -cp
    /home/jsuereth/projects/sbt/sbt-native-packager/tutorial-example/target/universal/stage/lib/example-cli.example-cli-1.0.jar:/home/jsuereth/projects/sbt/sbt-native-packager/tutorial-example/target/universal/stage/lib/org.scala-lang.scala-library-2.10.3.jar:/home/jsuereth/projects/sbt/sbt-native-packager/tutorial-example/target/universal/stage/lib/com.typesafe.config-1.2.0.jar
    TestApp
</pre></div>
</div>
<p>As you can see <tt class="docutils literal"><span class="pre">-d</span></tt> is a reserved parameter. If you need to use this for your application you can
use the following syntax</p>
<div class="highlight-python"><div class="highlight"><pre>./target/universal/stage/bin/example-cli -- -d
</pre></div>
</div>
<p>This will prevent the bashscript from interpreting the <tt class="docutils literal"><span class="pre">-d</span></tt> as the debug parameter</p>
</div>
<div class="section" id="customize-application-ini-name">
<h3>Customize application.ini name<a class="headerlink" href="#customize-application-ini-name" title="Permalink to this headline">¶</a></h3>
<p>If you don&#8217;t like <tt class="docutils literal"><span class="pre">application.ini</span></tt> as a name, you can change this in the <tt class="docutils literal"><span class="pre">build.sbt</span></tt>.
The default configuration looks like this</p>
<div class="highlight-python"><div class="highlight"><pre>bashScriptConfigLocation := Some(&quot;${app_home}/../conf/application.ini&quot;)
</pre></div>
</div>
<p>These additions are useful if you need to reference existing variables from the
bashscript.</p>
</div>
</div>
<div class="section" id="example-typesafe-config-library">
<h2>Example: Typesafe Config Library<a class="headerlink" href="#example-typesafe-config-library" title="Permalink to this headline">¶</a></h2>
<p>Now that we have ability to configure the JVM, let&#8217;s add in a more robust method of customizing the application.  We&#8217;ll be using the <a class="reference external" href="https://github.com/typesafehub/config">Typesafe Config</a> library for this purpose.</p>
<p>First, let&#8217;s add it as a dependency in <tt class="docutils literal"><span class="pre">build.sbt</span></tt></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">libraryDependencies</span> <span class="o">+=</span> <span class="s">&quot;com.typesafe&quot;</span> <span class="o">%</span> <span class="s">&quot;config&quot;</span> <span class="o">%</span> <span class="s">&quot;1.2.0&quot;</span>
</pre></div>
</div>
<p>Next, let&#8217;s create the configuration file itself.  Add the following to <tt class="docutils literal"><span class="pre">src/universal/conf/app.config</span></tt></p>
<div class="highlight-python"><div class="highlight"><pre>example {
  greeting = &quot;Hello, World!&quot;
}
</pre></div>
</div>
<p>Now, we need a means of telling the typesafe config library where to find our configuration.  The library supports
a JVM property &#8220;<tt class="docutils literal"><span class="pre">config.file</span></tt>&#8221; which it will use to look for configuration.   Let&#8217;s expose this file
in the startup BASH script.  To do so, add the following to <tt class="docutils literal"><span class="pre">build.sbt</span></tt></p>
<div class="highlight-python"><div class="highlight"><pre>bashScriptExtraDefines += &quot;&quot;&quot;addJava &quot;-Dconfig.file=${app_home}/../conf/app.config&quot;&quot;&quot;&quot;
</pre></div>
</div>
<p>This line modifies the generated BASH script to add the JVM options the location of the application configuration on disk.  Now, let&#8217;s modify the application (<tt class="docutils literal"><span class="pre">src/main/scala/TestApp.scala</span></tt>) to read this configuration</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="k">import</span> <span class="nn">com.typesafe.config.ConfigFactory</span>

<span class="k">object</span> <span class="nc">TestApp</span> <span class="k">extends</span> <span class="nc">App</span> <span class="o">{</span>
  <span class="k">val</span> <span class="n">config</span> <span class="k">=</span> <span class="nc">ConfigFactory</span><span class="o">.</span><span class="n">load</span><span class="o">()</span>
  <span class="n">println</span><span class="o">(</span><span class="n">config</span><span class="o">.</span><span class="n">getString</span><span class="o">(</span><span class="s">&quot;example.greeting&quot;</span><span class="o">))</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Now, let&#8217;s try it out on the command line</p>
<div class="highlight-python"><div class="highlight"><pre>$ sbt stage
$ ./target/universal/stage/bin/example-cli
Hello, World!
</pre></div>
</div>
<p>Finally, let&#8217;s see what this configuration looks like in a linux distribution.  Let&#8217;s run the debian packaging again</p>
<div class="highlight-python"><div class="highlight"><pre>$ sbt debian:packageBin
</pre></div>
</div>
<p>The resulting structure is the following</p>
<div class="highlight-python"><div class="highlight"><pre>/usr/
  share/example-cli/
    conf/
      app.config
      application.ini
    bin/
      example-cli
    lib/
      example-cli.example-cli-1.0.jar
      org.scala-lang.scala-library-2.10.3.jar
  bin/
    example-cli -&gt; ../share/example-cli/bin/example-cli
/etc/
   example-cli -&gt; /usr/share/example-cli/conf
</pre></div>
</div>
<p>Here, we can see that the entire <tt class="docutils literal"><span class="pre">conf</span></tt> directory for the application is exposed on <tt class="docutils literal"><span class="pre">/etc</span></tt> as is standard for
other linux applications.  By convention, all files in the universal <tt class="docutils literal"><span class="pre">conf</span></tt> directory are marked as configuration
files when packaged, allowing users to modify them.</p>
<div class="section" id="configuring-for-windows">
<h3>Configuring for Windows<a class="headerlink" href="#configuring-for-windows" title="Permalink to this headline">¶</a></h3>
<p>While we just covered how to do configuration for linux/mac, windows offers some subtle differences.</p>
<p>First, while the BASH file allows you to configure where to load JVM options and default arguments, in
windows we can only configure JVM options.  The path is hardcoded, as well to:</p>
<p><tt class="docutils literal"><span class="pre">&lt;install</span> <span class="pre">directory&gt;/&#64;&#64;APP_ENV_NAME&#64;&#64;_config.txt</span></tt></p>
<p>where <tt class="docutils literal"><span class="pre">&#64;&#64;APP_ENV_NAME&#64;&#64;</span></tt> is replaced with an environment friendly name for your app.   In this example, that would be: <tt class="docutils literal"><span class="pre">EXAMPLE_CLI</span></tt>.</p>
<p>We can provide a configuration for JVM options on windows by creating a <tt class="docutils literal"><span class="pre">src/universal/EXAMPLE_CLI_config.txt</span></tt> file with the following contents</p>
<div class="highlight-python"><div class="highlight"><pre><span class="o">-</span><span class="n">Xmx512M</span>
<span class="o">-</span><span class="n">Xms128M</span>
</pre></div>
</div>
<p>This will add each line of the file as arguments to the JVM when running your application.</p>
<p>Now, if we want to add the typesafe config library again, we need to write the <tt class="docutils literal"><span class="pre">config.file</span></tt> property into the JVM options again.</p>
<p>One means of doing this is hooking the <tt class="docutils literal"><span class="pre">batScriptExtraDefines</span></tt> key.  This allows us to insert various BAT settings/commands into the script.  Let&#8217;s use this to hook the config file location, using the other variables in the BASH script.  Modify your <tt class="docutils literal"><span class="pre">build.sbt</span></tt> as follows</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">batScriptExtraDefines</span> <span class="o">+=</span> <span class="s">&quot;&quot;&quot;set _JAVA_OPTS=%_JAVA_OPTS% -Dconfig.file=</span><span class="si">%E</span><span class="s">XAMPLE_CLI_HOME%</span><span class="se">\\</span><span class="s">conf</span><span class="se">\\</span><span class="s">app.config&quot;&quot;&quot;</span>
</pre></div>
</div>
<p>Now, the windows version will also load the configuration from the <tt class="docutils literal"><span class="pre">conf/</span></tt> directory of the package.</p>
</div>
<div class="section" id="more-complex-scripts">
<h3>More Complex Scripts<a class="headerlink" href="#more-complex-scripts" title="Permalink to this headline">¶</a></h3>
<p>As you read earlier the <tt class="docutils literal"><span class="pre">bashScriptExtraDefines</span></tt> sequence allows you to add new lines to the default bash script used to start the application.
This is useful when you need a setting which isn&#8217;t mean for the command-line parameter list passed to the java process. The lines added to
<tt class="docutils literal"><span class="pre">bashScriptExtraDefines</span></tt> are placed near the end of the script and have access to a number of utility bash functions (e.g. <tt class="docutils literal"><span class="pre">addJava</span></tt>,
<tt class="docutils literal"><span class="pre">addApp</span></tt>, <tt class="docutils literal"><span class="pre">addResidual</span></tt>, <tt class="docutils literal"><span class="pre">addDebugger</span></tt>). You can add lines to this script as we did for the Typesafe config file above. For more complex
scripts you can also inject a separate file managed in your source tree or resource directory:</p>
<div class="highlight-python"><div class="highlight"><pre>bashScriptExtraDefines ++= IO.readLines(baseDirectory.value / &quot;scripts&quot; / &quot;extra.sh&quot;)
</pre></div>
</div>
<p>This will add the contents of <tt class="docutils literal"><span class="pre">/scripts/extra.sh</span></tt> in the resource directory to the bash script. Note you should always concatenate lines
to <tt class="docutils literal"><span class="pre">bashScriptExtraDefines</span></tt> as other stages in the pipeline may be include lines to the start-script.</p>
</div>
</div>
<div class="section" id="overriding-templates-bash-bat">
<h2>Overriding Templates (Bash/Bat)<a class="headerlink" href="#overriding-templates-bash-bat" title="Permalink to this headline">¶</a></h2>
<p>In order to override full templates, like the default bash script, you can create a file in <tt class="docutils literal"><span class="pre">src/templates/bash-template</span></tt>.
Alternatively, you can use a different file location by setting <tt class="docutils literal"><span class="pre">bashScriptTemplateLocation</span></tt>.</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="c">#!/usr/bin/env bash</span>

realpath<span class="o">()</span> <span class="o">{</span>
  <span class="c"># TODO - The original bash template has a robust mechanism to find the true</span>
  <span class="c">#        path to your application, following multiple symlinks.</span>
  <span class="c">#</span>
<span class="o">}</span>

addJava<span class="o">()</span> <span class="o">{</span>
  <span class="c"># Here we override the original templates addJava method to do nothing,</span>
  <span class="c"># since this was how we were adding configuration before.</span>
<span class="o">}</span>

<span class="nb">declare</span> -r <span class="nv">real_script_path</span><span class="o">=</span><span class="s2">&quot;</span><span class="k">$(</span>realpath <span class="s2">&quot;</span><span class="nv">$0</span><span class="s2">&quot;</span><span class="k">)</span><span class="s2">&quot;</span>

<span class="c"># We have to provide an app_home for the default bash declarations to work.</span>
    <span class="nb">declare</span> -r <span class="nv">app_home</span><span class="o">=</span><span class="s2">&quot;</span><span class="k">$(</span>realpath <span class="s2">&quot;</span><span class="k">$(</span>dirname <span class="s2">&quot;</span><span class="nv">$real_script_path</span><span class="s2">&quot;</span><span class="k">)</span><span class="s2">&quot;</span><span class="k">)</span><span class="s2">&quot;</span>

    <span class="c"># The auto-generated classpath relies on this variable existing</span>
    <span class="c"># and pointing at the lib directory.</span>
<span class="nb">declare</span> -r <span class="nv">lib_dir</span><span class="o">=</span><span class="s2">&quot;</span><span class="k">$(</span>realpath <span class="s2">&quot;</span><span class="si">${</span><span class="nv">app_home</span><span class="si">}</span><span class="s2">/../lib&quot;</span><span class="k">)</span><span class="s2">&quot;</span>

<span class="c"># This line tells the native packager template engine to inject</span>
<span class="c"># all of its settings into this spot in the bash file.</span>
<span class="si">${</span><span class="p">{template_declares</span><span class="si">}</span><span class="o">}</span>

<span class="c"># Here we make use of two of the injected settings for the bash file:</span>
<span class="c"># * app_classpath - represents the full list of JARs for this application.</span>
<span class="c"># * app_mainclass - represents the class with a main method we should call.</span>
<span class="nb">exec </span>java -cp <span class="nv">$app_classpath</span> <span class="nv">$app_mainclass</span> <span class="nv">$@</span>
</pre></div>
</div>
<p>Similarly the windows BAT template can be overridden by placing a new template in <tt class="docutils literal"><span class="pre">src/templates/bat-template</span></tt>.
You can also use a different file location by setting <tt class="docutils literal"><span class="pre">batScriptTemplateLocation</span></tt>.</p>
<div class="highlight-bat"><div class="highlight"><pre><span class="p">@</span>REM A bat starter script
<span class="p">@</span><span class="k">echo</span> <span class="k">off</span>

<span class="p">@</span>REM Here we need to <span class="k">set</span> <span class="nv">up</span> a <span class="s2">&quot;home&quot;</span> variable <span class="k">for</span> our classpath.
<span class="p">@</span>REM The APP_ENV_NAME variable is replaced by the packager template engine
<span class="p">@</span>REM with an <span class="s2">&quot;environment variable friendly&quot;</span> name <span class="k">for</span> the app.
<span class="k">if</span> <span class="s2">&quot;%@@APP_ENV_NAME@@_HOME%&quot;</span><span class="o">==</span><span class="s2">&quot;&quot;</span> <span class="k">set</span> <span class="s2">&quot;@@APP_ENV_NAME@@_HOME=%~dp0\\..&quot;</span>
<span class="k">set</span> <span class="s2">&quot;APP_LIB_DIR=%@@APP_ENV_NAME@@_HOME%\lib\&quot;</span>

<span class="p">@</span>REM - This tells the template engine to inject any custom defines into our bat file here.
<span class="p">@</span>@APP_DEFINES@@

<span class="p">@</span>REM - Here we use the provided APP_CLASSPATH and APP_MAIN_CLASS parameters
java -cp <span class="s2">&quot;%APP_CLASSPATH%&quot;</span> <span class="nv">%APP_MAIN_CLASS%</span> %*
</pre></div>
</div>
<p>While we just replaced the default templates with simpler templates, this should really only be done if:</p>
<ol class="arabic simple">
<li>There is a bug in one of the script templates you need to workaround</li>
<li>There is a deficiency in the features of one of the templates you need to fix.</li>
</ol>
<p>In general, the templates are intended to provide enough utility that customization is only necessary for truly custom scripts.</p>
<div class="section" id="overriding-bat-templates-src-templates-bat-template-or-a-custom-path-using-batscripttemplatelocation">
<h3>Overriding bat templates (<tt class="docutils literal"><span class="pre">src/templates/bat-template</span></tt> or a custom path using <tt class="docutils literal"><span class="pre">batScriptTemplateLocation</span></tt>)<a class="headerlink" href="#overriding-bat-templates-src-templates-bat-template-or-a-custom-path-using-batscripttemplatelocation" title="Permalink to this headline">¶</a></h3>
<p>This will override the default template used to generate the <tt class="docutils literal"><span class="pre">.bat</span></tt> script for windows distributions.</p>
<p><strong>Syntax</strong></p>
<p><tt class="docutils literal"><span class="pre">&#64;&#64;APP_ENV_NAME&#64;&#64;</span></tt> - will be replaced with the script friendly name of your package.</p>
<p><tt class="docutils literal"><span class="pre">&#64;&#64;APP_NAME&#64;&#64;</span></tt> - will be replaced with user friendly name of your package.</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">&#64;APP_DEFINES&#64;&#64;</span></tt> - will be replaced with a set of variable definitions, like</dt>
<dd><tt class="docutils literal"><span class="pre">APP_MAIN_CLASS</span></tt>, <tt class="docutils literal"><span class="pre">APP_MAIN_CLASS</span></tt>.</dd>
</dl>
<p>You can define additional variable definitions using <tt class="docutils literal"><span class="pre">batScriptExtraDefines</span></tt>.</p>
</div>
<div class="section" id="overriding-bash-templates-src-templates-bash-template-or-a-custom-path-using-bashscripttemplatelocation">
<h3>Overriding bash templates (<tt class="docutils literal"><span class="pre">src/templates/bash-template</span></tt> or a custom path using <tt class="docutils literal"><span class="pre">bashScriptTemplateLocation</span></tt>)<a class="headerlink" href="#overriding-bash-templates-src-templates-bash-template-or-a-custom-path-using-bashscripttemplatelocation" title="Permalink to this headline">¶</a></h3>
<p>This will override the default template used to generate the BASH start script found in <tt class="docutils literal"><span class="pre">bin/&lt;application&gt;</span></tt> in the
universal distribution</p>
<p><strong>Syntax</strong></p>
<p><tt class="docutils literal"><span class="pre">${{template_declares}}</span></tt> - Will be replaced with a series of <tt class="docutils literal"><span class="pre">declare</span> <span class="pre">&lt;var&gt;</span></tt>
lines based on the <tt class="docutils literal"><span class="pre">bashScriptDefines</span></tt> key.  You can add more defines to
the <tt class="docutils literal"><span class="pre">bashScriptExtraDefines</span></tt> that will be used in addition to the default set:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">app_mainclass</span></tt> - The main class entry point for the application.</li>
<li><tt class="docutils literal"><span class="pre">app_classpath</span></tt> - The complete classpath for the application (in order).</li>
</ul>
<p>Next, let&#8217;s look at how to <a class="reference internal" href="writing-documentation.html"><em>document the application</em></a>.</p>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2014 sbt-native-packager team.<br/>
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2.3.<br/>
    </p>
  </div>
</footer>
  </body>
</html>